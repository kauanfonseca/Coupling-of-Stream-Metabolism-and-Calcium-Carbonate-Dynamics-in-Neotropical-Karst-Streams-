results <- bayesmetab(data.dir = file_name, results.dir = results_dir, interval = 600)
}
summary(BASE_input)
# ---- Load Required Libraries ----
library(dplyr)
library(lubridate)
library(R2jags)
library(BASEmetab)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Split, Prepare, and Save Data by Stream ----
streams <- HighFrequencyData %>%
distinct(stream_name, stream_abreviation)
for (i in 1:nrow(streams)) {
# Filter for current stream
stream_data <- HighFrequencyData %>%
filter(stream_name == streams$stream_name[i])
# Prepare and clean data (remove unnecessary columns before saving)
BASE_input <- stream_data %>%
mutate(
Date = as.Date(sampling_datetime),
Time = format(sampling_datetime, "%H:%M:%S"),
I = par_umol_m2_s,
tempC = temp_c,
DO.meas = dissolved_oxygen_mgL,
atmo.pressure = 1,
salinity = 0
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)  # Remove stream info columns here
# Save dataset for current stream (no stream name/abbreviation in file)
file_name <- paste0("./incremental/BASE_input_", streams$stream_abreviation[i], ".csv")
write.csv(BASE_input, file_name, row.names = FALSE)
# Set output directory for current stream
results_dir <- file.path(getwd(), "results", "StreamMetabolism", streams$stream_abreviation[i])
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
# Run metabolism model for current stream
message("Running bayesmetab model for stream: ", streams$stream_abreviation[i])
results <- bayesmetab(data.dir = file_name, results.dir = results_dir, interval = 600)
}
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Remove Rows with Missing Temperature or DO ----
HighFrequencyData <- HighFrequencyData %>%
filter(!is.na(temp_c) & !is.na(dissolved_oxygen_mgL))
# ---- Split, Format & Save Data per Stream ----
streams <- HighFrequencyData %>% distinct(stream_name, stream_abreviation)
for (i in 1:nrow(streams)) {
stream_data <- HighFrequencyData %>%
filter(stream_abreviation == streams$stream_abreviation[i])
BASE_input <- stream_data %>%
mutate(
Date = as.Date(sampling_datetime),                          # yyyy-mm-dd
Time = format(sampling_datetime, "%H:%M:%S"),              # hh:mm:ss
I = par_umol_m2_s,
tempC = temp_c,
DO.meas = dissolved_oxygen_mgL,
atmo.pressure = 1,
salinity = 0
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)
# Save CSV for model
file_name <- paste0("./incremental/BASE_input_", streams$stream_abreviation[i], ".csv")
write.csv(BASE_input, file_name, row.names = FALSE)
# Check full day coverage:
rows_per_day <- BASE_input %>%
group_by(Date) %>%
tally() %>%
filter(n != 144)  # Assuming 10-min intervals → 144 points per day
if (nrow(rows_per_day) > 0) {
warning("Incomplete days detected in stream: ", streams$stream_abreviation[i],
". Model will exclude these automatically.")
}
# Output directory for stream
results_dir <- file.path(getwd(), "results", "StreamMetabolism", streams$stream_abreviation[i])
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
# Run Metabolism Model
message("Running bayesmetab for stream: ", streams$stream_abreviation[i])
bayesmetab(file_name, results_dir, interval = 600)
}
View(rows_per_day)
# Parse datetime first
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# Parse datetime first
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# Filter NAs (you already do this)
HighFrequencyData <- HighFrequencyData %>%
filter(!is.na(temp_c) & !is.na(dissolved_oxygen_mgL))
# Check time interval consistency per stream
HighFrequencyData %>%
arrange(stream_abreviation, sampling_datetime) %>%
group_by(stream_abreviation) %>%
mutate(time_diff = as.numeric(difftime(sampling_datetime, lag(sampling_datetime), units = "mins"))) %>%
summarise(
n = n(),
min_interval = min(time_diff, na.rm = TRUE),
max_interval = max(time_diff, na.rm = TRUE),
missing_steps = sum(is.na(time_diff)) + sum(time_diff != 10, na.rm = TRUE)
)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Remove Rows with Missing Temperature or DO ----
HighFrequencyData <- HighFrequencyData %>%
filter(!is.na(temp_c) & !is.na(dissolved_oxygen_mgL))
# ---- Split Data by Stream ----
streams <- HighFrequencyData %>% distinct(stream_name, stream_abreviation)
for (i in 1:nrow(streams)) {
stream_data <- HighFrequencyData %>%
filter(stream_abreviation == streams$stream_abreviation[i]) %>%
arrange(sampling_datetime) %>%
mutate(time_diff = as.numeric(difftime(sampling_datetime, lag(sampling_datetime), units = "mins")),
campaign = cumsum(ifelse(is.na(time_diff) | time_diff > 60, 1, 0)))  # New campaign if > 60 min gap
# ---- Loop Over Campaigns ----
campaigns <- unique(stream_data$campaign)
for (camp in campaigns) {
camp_data <- stream_data %>% filter(campaign == camp)
# Format Data
BASE_input <- camp_data %>%
mutate(
Date = as.Date(sampling_datetime),
Time = format(sampling_datetime, "%H:%M:%S"),
I = par_umol_m2_s,
tempC = temp_c,
DO.meas = dissolved_oxygen_mgL,
atmo.pressure = 1,
salinity = 0
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)
# Save Input File
file_name <- paste0("./incremental/BASE_input_", streams$stream_abreviation[i], "_campaign", camp, ".csv")
write.csv(BASE_input, file_name, row.names = FALSE)
# Create Output Directory
results_dir <- file.path(getwd(), "results", "StreamMetabolism",
streams$stream_abreviation[i],
paste0("campaign_", camp))
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
# Run Metabolism Model
message("Running bayesmetab for ", streams$stream_abreviation[i], " - campaign ", camp)
bayesmetab(data.dir = file_name, results.dir = results_dir, interval = 600)
}
}
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Remove Rows with Missing Temperature or DO ----
HighFrequencyData <- HighFrequencyData %>%
filter(!is.na(temp_c) & !is.na(dissolved_oxygen_mgL))
# ---- Split Data by Stream ----
streams <- HighFrequencyData %>% distinct(stream_name, stream_abreviation)
stream_data <- HighFrequencyData %>%
filter(stream_abreviation == streams$stream_abreviation[i]) %>%
arrange(sampling_datetime) %>%
mutate(time_diff = as.numeric(difftime(sampling_datetime, lag(sampling_datetime), units = "mins")),
campaign = cumsum(ifelse(is.na(time_diff) | time_diff > 60, 1, 0)))  # New campaign if > 60 min gap
View(stream_data)
View(HighFrequencyData)
# ---- Loop Over Campaigns ----
campaigns <- unique(stream_data$campaign)
library(readr)
BASE_input_CD <- read_csv("incremental/BASE_input_CD.csv")
View(BASE_input_CD)
summary(BASE_input_CD)
plot(BASE_input_CD$DO.meas~BASE_input_CD$Date)
plot(HighFrequencyData$temp_c~HighFrequencyData$sampling_datetime)
plot(HighFrequencyData$temp_c~HighFrequencyData$sampling_datetime, color =HighFrequencyData$stream_abreviation )
plot(HighFrequencyData$temp_c~HighFrequencyData$sampling_datetime)
plot(HighFrequencyData$dissolved_oxygen_percent~HighFrequencyData$sampling_datetime)
summary(HighFrequencyData)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")  # Adjust filename as needed
summary(HighFrequencyData)
View(HighFrequencyData)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")  # Adjust filename as needed
summary(HighFrequencyData)
# Parse datetime column
HighFrequencyData$sampling_datetime <- ymd_hms(HighFrequencyData$sampling_datetime)
# ---- Load Required Libraries ----
library(dplyr)
library(lubridate)
library(ggplot2)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- List of Variables to Plot ----
vars_to_plot <- c(
"par_umol_m2_s", "temp_c", "specific_cond_uS_cm",
"dissolved_oxygen_mgL", "dissolved_oxygen_percent", "calcium_mgL"
)
# ---- Plot Variables Over Time ----
for (var in vars_to_plot) {
p <- ggplot(HighFrequencyData, aes(x = sampling_datetime, y = .data[[var]])) +
geom_line(color = "steelblue") +
facet_wrap(~ stream_abreviation, scales = "free_y", ncol = 1) +
labs(
title = paste("Time Series of", var),
x = "Sampling Datetime",
y = var
) +
theme_minimal() +
theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
print(p)
}
# ---- Plot Variables Over Time ----
for (var in vars_to_plot) {
p <- ggplot(HighFrequencyData, aes(x = sampling_datetime, y = .data[[var]])) +
geom_line(color = "steelblue") +
facet_wrap(~ stream_abreviation, scales = "free_y", ncol = 1) +
labs(
title = paste("Time Series of", var),
x = "Sampling Datetime",
y = var
) +
theme_minimal() +
theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
print(p)
}
ggplot(HighFrequencyData, aes(x = sampling_datetime, y = .data[[var]])) +
geom_line(color = "steelblue") +
facet_wrap(~ stream_abreviation, scales = "free_y", ncol = 1) +
labs(
title = paste("Time Series of", var),
x = "Sampling Datetime",
y = var
) +
theme_minimal() +
theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
# ---- Load Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse DateTime Safely ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Check Parsing Worked ----
if (!inherits(HighFrequencyData$sampling_datetime, "POSIXct")) {
stop("Datetime parsing failed.")
}
# ---- Variables to Plot ----
vars_to_plot <- c(
"par_umol_m2_s", "temp_c", "specific_cond_uS_cm",
"dissolved_oxygen_mgL", "dissolved_oxygen_percent", "calcium_mgL"
)
# ---- Check Variables Have Data ----
non_na_counts <- sapply(HighFrequencyData[vars_to_plot], function(x) sum(!is.na(x)))
print(non_na_counts)
# ---- Plot Variables Over Time ----
for (var in vars_to_plot) {
if (non_na_counts[var] > 0) {
p <- ggplot(HighFrequencyData, aes(x = sampling_datetime, y = .data[[var]])) +
geom_line(color = "steelblue", linewidth = 0.4, na.rm = TRUE) +
facet_wrap(~ stream_abreviation, scales = "free_y", ncol = 1) +
labs(
title = paste("Time Series of", var),
x = "Sampling Datetime",
y = var
) +
theme_minimal() +
theme(
strip.text = element_text(size = 12, face = "bold"),
plot.title = element_text(size = 14, face = "bold", hjust = 0.5)
)
print(p)
} else {
message("Skipping ", var, " — No non-NA values.")
}
}
# Extract Date and Time from sampling_datetime
BASE_input <- HighFrequencyData %>%
group_by(stream_name, stream_abreviation) %>%
mutate(
Date = as.Date(sampling_datetime),                       # Extract date
Time = format(sampling_datetime, "%H:%M:%S"),            # Extract time
I = par_umol_m2_s,                                       # PAR
tempC = temp_c,                                          # Temp
DO.meas = dissolved_oxygen_mgL,                          # Dissolved O2
atmo.pressure = 1,                                       # Atmospheric Pressure
salinity = 0                                             # Salinity
)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")  # Adjust filename as needed
summary(HighFrequencyData)
# Parse datetime column
HighFrequencyData$sampling_datetime <- ymd_hms(HighFrequencyData$sampling_datetime)
ggplot(HighFrequencyData, aes(x=sampling_datetime, y))
# Extract Date and Time from sampling_datetime
BASE_input <- HighFrequencyData %>%
group_by(stream_name, stream_abreviation) %>%
mutate(
Date = as.Date(sampling_datetime),                       # Extract date
Time = format(sampling_datetime, "%H:%M:%S"),            # Extract time
I = par_umol_m2_s,                                       # PAR
tempC = temp_c,                                          # Temp
DO.meas = dissolved_oxygen_mgL,                          # Dissolved O2
atmo.pressure = 1,                                       # Atmospheric Pressure
salinity = 0                                             # Salinity
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_grid(stream_abreviation)
View(BASE_input)
View(BASE_input)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_grid(stream_name)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_wrap(stream_name~)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_wrap(stream_name~)
library(ggplot2)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_wrap(~stream_name)
library(ggplot2)
ggplot(BASE_input, aes(x=sampling_datetime, y=DO.meas)) +
geom_line() + geom_point() +
facet_wrap(~stream_name)
library(dplyr)
library(ggplot2)
library(lubridate)
BASE_input <- BASE_input %>%
mutate(
datetime = as.POSIXct(paste(Date, Time), format = "%Y-%m-%d %H:%M:%S")
)
ggplot(BASE_input, aes(x = datetime, y = DO.meas)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_name, scales = "free_y") +
labs(
title = "Dissolved Oxygen Over Time",
x = "Datetime",
y = "Dissolved Oxygen (mg/L)"
) +
theme_minimal()
,
ggplot(BASE_input, aes(x = datetime, y = DO.meas)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_name, scales = "free_y")  +
theme_minimal()
ggplot(BASE_input, aes(x = datetime, y = DO.meas)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_name, scales = "free_y")  +
theme_minimal()
ggplot(BASE_input, aes(x = datetime, y = DO.meas)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_name, scales = "free")  +
theme_minimal()
ggplot(BASE_input, aes(x = datetime, y = DO.meas)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_abreviation, scales = "free")  +
theme_minimal()
ggplot(BASE_input, aes(x = datetime, y = tempC)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_abreviation, scales = "free")  +
theme_minimal()
ggplot(BASE_input, aes(x = datetime, y = I)) +
geom_line() +
geom_point(size = 0.5) +
facet_wrap(~ stream_abreviation, scales = "free")  +
theme_minimal()
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")  # Adjust filename as needed
summary(HighFrequencyData)
# Parse datetime column
HighFrequencyData$sampling_datetime <- ymd_hms(HighFrequencyData$sampling_datetime)
# Extract Date and Time from sampling_datetime
BASE_input <- HighFrequencyData %>%
group_by(stream_name, stream_abreviation) %>%
mutate(
Date = as.Date(sampling_datetime),                       # Extract date
Time = format(sampling_datetime, "%H:%M:%S"),            # Extract time
I = par_umol_m2_s,                                       # PAR
tempC = temp_c,                                          # Temp
DO.meas = dissolved_oxygen_mgL,                          # Dissolved O2
atmo.pressure = 1,                                       # Atmospheric Pressure
salinity = 0                                             # Salinity
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)
# ---- Check Data Preview ----
head(BASE_input)
summary(BASE_input)
if (dir.exists(results.dir)){} else {
dir.create(results.dir)}
# ---- Save Final Prepared Data ----
write.csv(BASE_input, "./incremental/BASE_input.csv", row.names = FALSE)
data.dir <- "./incremental/BASE_input"
#set output directory to Output folder in current working directory.
results.dir <- file.path(getwd(), "./results/StreamMetabolism")
if (dir.exists(results.dir)){} else {
dir.create(results.dir)}
#run model.
results <- bayesmetab(data.dir, results.dir, interval = 600)
View(results)
# ---- Load Required Libraries ----
library(dplyr)
library(lubridate)
library(R2jags)
library(BASEmetab)
# ---- Load High-Frequency Data ----
HighFrequencyData <- read.csv("./data/HighFrequencyData.csv")
# ---- Parse Datetime Column ----
HighFrequencyData$sampling_datetime <- as.POSIXct(
HighFrequencyData$sampling_datetime, format = "%Y%m%d %H:%M:%S"
)
# ---- Remove Rows with Missing Temperature or DO ----
HighFrequencyData <- HighFrequencyData %>%
filter(!is.na(temp_c) & !is.na(dissolved_oxygen_mgL))
# ---- Split, Prepare, and Save Data by Stream ----
streams <- HighFrequencyData %>%
distinct(stream_name, stream_abreviation)
for (i in 1:nrow(streams)) {
# Filter for current stream
stream_data <- HighFrequencyData %>%
filter(stream_name == streams$stream_name[i])
# Prepare and clean data (remove unnecessary columns before saving)
BASE_input <- stream_data %>%
mutate(
Date = as.Date(sampling_datetime),
Time = format(sampling_datetime, "%H:%M:%S"),
I = par_umol_m2_s,
tempC = temp_c,
DO.meas = dissolved_oxygen_mgL,
atmo.pressure = 1,
salinity = 0
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)  # Remove stream info columns here
# Save dataset for current stream (no stream name/abbreviation in file)
file_name <- paste0("./incremental/BASE_input_", streams$stream_abreviation[i], ".csv")
write.csv(BASE_input, file_name, row.names = FALSE)
# Set output directory for current stream
results_dir <- file.path(getwd(), "results", "StreamMetabolism", streams$stream_abreviation[i])
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
# Run metabolism model for current stream
message("Running bayesmetab model for stream: ", streams$stream_abreviation[i])
results <- bayesmetab(data.dir = file_name, results.dir = results_dir, interval = 600)
}
for (i in 1:nrow(streams)) {
# Filter for current stream
stream_data <- HighFrequencyData %>%
filter(stream_name == streams$stream_name[i])
# Prepare and clean data (remove unnecessary columns before saving)
BASE_input <- stream_data %>%
mutate(
Date = as.Date(sampling_datetime),
Time = format(sampling_datetime, "%H:%M:%S"),
I = par_umol_m2_s,
tempC = temp_c,
DO.meas = dissolved_oxygen_mgL,
atmo.pressure = 1,
salinity = 0
) %>%
select(Date, Time, I, tempC, DO.meas, atmo.pressure, salinity)  # Remove stream info columns here
# Save dataset for current stream (no stream name/abbreviation in file)
file_name <- paste0("./incremental/BASE_input_", streams$stream_abreviation[i], ".csv")
write.csv(BASE_input, file_name, row.names = FALSE)
# Set output directory for current stream
results_dir <- file.path(getwd(), "results", "StreamMetabolism")
if (!dir.exists(results_dir)) dir.create(results_dir, recursive = TRUE)
# Run metabolism model for current stream
message("Running bayesmetab model for stream: ", streams$stream_abreviation[i])
results <- bayesmetab(data.dir = file_name, results.dir = results_dir, interval = 600)
}
data.dir <- "./incremental/BASE_input"
#set output directory to Output folder in current working directory.
results.dir <- file.path(getwd(), "./results/BASEmeta_output")
if (dir.exists(results.dir)){} else {
dir.create(results.dir)}
#run model.
results <- bayesmetab(data.dir, results.dir, interval = 600)
View(HighFrequencyData)
View(HighFrequencyData)
View(HighFrequencyData)
View(HighFrequencyData)
View(HighFrequencyData)
library(readr)
BASE_input_CD <- read_csv("incremental/BASE_input_CD.csv")
View(BASE_input_CD)
